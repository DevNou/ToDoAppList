<div class="container mt-4">
  <h1 class="mb-4 text-center">To-Do List</h1>

  <!-- Messages -->
  <div *ngIf="successMessage" class="alert alert-success">
    {{ successMessage }}
  </div>
  <div *ngIf="errorMessage" class="alert alert-danger">
    {{ errorMessage }}
  </div>

  <!-- Form -->
  <form #myForm="ngForm" (ngSubmit)="onSubmit(myForm)">
    <div class="mb-3">
      <label for="task" class="form-label">Task to complete</label>
      <input
        type="text"
        ngModel
        name="newTask"
        placeholder="Enter your task here"
        class="form-control"
        id="task"
        required
      />
      <div
        *ngIf="myForm.controls['newTask']?.invalid && myForm.controls['newTask']?.touched"
        class="form-text text-danger"
      >
        Required field
      </div>
    </div>

    <button type="submit" class="btn btn-primary me-2" [disabled]="myForm.invalid">
      Add Task
    </button>
    <button type="button" class="btn btn-secondary me-2" (click)="clearAll()">
      Clear All
    </button>
    <button type="button" class="btn btn-success" (click)="markAllComplete()">
      Mark All Complete
    </button>
  </form>

  <hr />

  <!-- Filter buttons -->
  <div class="btn-group mb-3">
    <button class="btn btn-outline-primary" (click)="filter='all'">All</button>
    <button class="btn btn-outline-success" (click)="filter='completed'">Completed</button>
    <button class="btn btn-outline-warning" (click)="filter='pending'">Pending</button>
  </div>

  <!-- Tasks table -->
  <table class="table table-hover">
    <thead>
      <tr>
        <th scope="col">Task</th>
        <th scope="col">Created</th>
        <th scope="col">Completed</th>
        <th scope="col">Edit</th>
        <th scope="col">Save</th>
        <th scope="col">Delete</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let item of taskArray | taskFilter:filter; let idx = index">
        <td>
          <input
            #taskinput
            type="text"
            [value]="item.taskName"
            class="form-control"
            [readOnly]="item.isReadOnly"
            [ngClass]="{
              edit: !item.isReadOnly,
              noedit: item.isReadOnly,
              crossed: item.isCompleted,
               'border-orange': !item.isReadOnly
              
            }"
          />
        </td>
        <td>{{ item.createdAt | date:'short' }}</td>
        <td class="text-center">
          <input
            type="checkbox"
            [checked]="item.isCompleted"
            (change)="onCheck(idx)"
            class="form-check-input"
          />
        </td>
        <td>
          <button class="btn btn-warning btn-sm me-1" (click)="onEdit(idx)" [disabled]="!item.isReadOnly" title="Edit">
            <i class="bi bi-pencil me-1"></i> Edit
          </button>
        </td>
        <td>
          <button class="btn btn-info btn-sm me-1" (click)="onSave(idx, taskinput.value)" [disabled]="item.isReadOnly" title="Save">
           <i class="bi bi-check-lg me-1"></i> Save
          </button>
        </td>
        <td>
          <button class="btn btn-danger btn-sm" (click)="onDelete(idx)" title="Delete">
          <i class="bi bi-trash me-1"></i> Delete
          </button>
        </td>
      </tr>

      <tr *ngIf="taskArray.length === 0">
        <td colspan="6" class="text-center text-muted">There are no tasks</td>
      </tr>
    </tbody>
  </table>

  <p>Task count: {{ count() }}</p>

  <!-- Footer -->
  <p class="text-center mt-3">
    <a href="#" class="me-2"><i class="bi bi-twitter"></i></a>
    <a href="#" class="me-2"><i class="bi bi-github"></i></a>
    <span class="copyright">Powered by DevAr</span>
  </p>
</div>
